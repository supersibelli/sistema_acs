{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header">
            <h2>Cadastro Individual</h2>
        </div>
        <div class="card-body">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <form method="POST" class="needs-validation" novalidate>
                {{ form.csrf_token }}
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>Dados do Profissional</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <label class="form-label">CNS do Profissional</label>
                                <p class="form-control-static">{{ dados_profissional.cns_profissional }}</p>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">CBO</label>
                                <p class="form-control-static">{{ dados_profissional.cbo }}</p>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">CNES</label>
                                <p class="form-control-static">{{ dados_profissional.cnes }}</p>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">INE</label>
                                <p class="form-control-static">{{ dados_profissional.ine }}</p>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-3">
                                <label class="form-label">Microárea</label>
                                <p class="form-control-static">{{ dados_profissional.microarea }}</p>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Data do Cadastro</label>
                                <p class="form-control-static">{{ dados_profissional.data_cadastro }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header">
                        <h5>Identificação do Cidadão</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                {{ form.nome_completo.label(class="form-label") }}
                                {{ form.nome_completo(class="form-control" + (" is-invalid" if form.nome_completo.errors else "")) }}
                                {% if form.nome_completo.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.nome_completo.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form.nome_social.label(class="form-label") }}
                                {{ form.nome_social(class="form-control") }}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                {{ form.data_nascimento.label(class="form-label") }}
                                {{ form.data_nascimento(class="form-control" + (" is-invalid" if form.data_nascimento.errors else ""),
                                                       placeholder="DD/MM/AAAA",
                                                       maxlength="10") }}
                                <small class="form-text text-muted">Formato: DD/MM/AAAA</small>
                                {% if form.data_nascimento.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.data_nascimento.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.sexo.label(class="form-label") }}
                                {{ form.sexo(class="form-control" + (" is-invalid" if form.sexo.errors else "")) }}
                                {% if form.sexo.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.sexo.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.raca_cor.label(class="form-label") }}
                                {{ form.raca_cor(class="form-control" + (" is-invalid" if form.raca_cor.errors else "")) }}
                                {% if form.raca_cor.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.raca_cor.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3" id="etnia-container" style="display: none;">
                                {{ form.etnia.label(class="form-label") }}
                                {{ form.etnia(class="form-control" + (" is-invalid" if form.etnia.errors else "")) }}
                                {% if form.etnia.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.etnia.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form.numero_nis.label(class="form-label") }}
                                {{ form.numero_nis(class="form-control" + (" is-invalid" if form.numero_nis.errors else "")) }}
                                {% if form.numero_nis.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.numero_nis.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    {{ form.nome_mae.label(class="form-label") }}
                                    <div class="form-check">
                                        {{ form.mae_desconhecida(class="form-check-input") }}
                                        {{ form.mae_desconhecida.label(class="form-check-label") }}
                                    </div>
                                </div>
                                {{ form.nome_mae(class="form-control" + (" is-invalid" if form.nome_mae.errors else "")) }}
                                {% if form.nome_mae.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.nome_mae.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    {{ form.nome_pai.label(class="form-label") }}
                                    <div class="form-check">
                                        {{ form.pai_desconhecido(class="form-check-input") }}
                                        {{ form.pai_desconhecido.label(class="form-check-label") }}
                                    </div>
                                </div>
                                {{ form.nome_pai(class="form-control" + (" is-invalid" if form.nome_pai.errors else "")) }}
                                {% if form.nome_pai.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.nome_pai.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                {{ form.nacionalidade.label(class="form-label") }}
                                {{ form.nacionalidade(class="form-control") }}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.pais_nascimento.label(class="form-label") }}
                                {{ form.pais_nascimento(class="form-control") }}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.data_naturalizacao.label(class="form-label") }}
                                {{ form.data_naturalizacao(class="form-control" + (" is-invalid" if form.data_naturalizacao.errors else ""),
                                                       placeholder="DD/MM/AAAA",
                                                       maxlength="10") }}
                                <small class="form-text text-muted">Formato: DD/MM/AAAA</small>
                                {% if form.data_naturalizacao.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.data_naturalizacao.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                {{ form.portaria_naturalizacao.label(class="form-label") }}
                                {{ form.portaria_naturalizacao(class="form-control") }}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.municipio_nascimento.label(class="form-label") }}
                                {{ form.municipio_nascimento(class="form-control") }}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.uf_nascimento.label(class="form-label") }}
                                {{ form.uf_nascimento(class="form-control") }}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                {{ form.data_entrada_brasil.label(class="form-label") }}
                                {{ form.data_entrada_brasil(class="form-control" + (" is-invalid" if form.data_entrada_brasil.errors else ""),
                                                       placeholder="DD/MM/AAAA",
                                                       maxlength="10") }}
                                <small class="form-text text-muted">Formato: DD/MM/AAAA</small>
                                {% if form.data_entrada_brasil.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.data_entrada_brasil.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.telefone_celular.label(class="form-label") }}
                                {{ form.telefone_celular(class="form-control") }}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.email.label(class="form-label") }}
                                {{ form.email(class="form-control") }}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                {{ form.cns_cidadao.label(class="form-label") }}
                                {{ form.cns_cidadao(class="form-control" + (" is-invalid" if form.cns_cidadao.errors else "")) }}
                                {% if form.cns_cidadao.errors %}
                                    <div class="invalid-feedback">{{ form.cns_cidadao.errors[0] }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.cpf_cidadao.label(class="form-label") }}
                                {{ form.cpf_cidadao(class="form-control" + (" is-invalid" if form.cpf_cidadao.errors else "")) }}
                                {% if form.cpf_cidadao.errors %}
                                    <div class="invalid-feedback">{{ form.cpf_cidadao.errors[0] }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 mb-3">
                                <div class="form-check">
                                    {{ form.responsavel_familiar(class="form-check-input") }}
                                    {{ form.responsavel_familiar.label(class="form-check-label") }}
                                </div>
                            </div>
                        </div>

                        <div id="dados_responsavel" class="row">
                            <div class="col-md-4 mb-3">
                                {{ form.cns_responsavel.label(class="form-label") }}
                                {{ form.cns_responsavel(class="form-control" + (" is-invalid" if form.cns_responsavel.errors else "")) }}
                                {% if form.cns_responsavel.errors %}
                                    <div class="invalid-feedback">{{ form.cns_responsavel.errors[0] }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.cpf_responsavel.label(class="form-label") }}
                                {{ form.cpf_responsavel(class="form-control" + (" is-invalid" if form.cpf_responsavel.errors else "")) }}
                                {% if form.cpf_responsavel.errors %}
                                    <div class="invalid-feedback">{{ form.cpf_responsavel.errors[0] }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header">
                        <h5>Informações Sociodemográficas</h5>
                    </div>
                    <div class="card-body">
                        <!-- Relação de Parentesco -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ form.parentesco_responsavel.label(class="form-label") }}
                                {{ form.parentesco_responsavel(class="form-control" + (" is-invalid" if form.parentesco_responsavel.errors else "")) }}
                                {% if form.parentesco_responsavel.errors %}
                                    <div class="invalid-feedback">{{ form.parentesco_responsavel.errors[0] }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <div class="form-check mt-4">
                                    {{ form.frequenta_escola(class="form-check-input") }}
                                    {{ form.frequenta_escola.label(class="form-check-label") }}
                                </div>
                            </div>
                        </div>

                        <!-- Situação no Mercado de Trabalho -->
                        <div class="row mb-3">
                            <div class="col-md-12">
                                {{ form.situacao_trabalho.label(class="form-label") }}
                                {{ form.situacao_trabalho(class="form-control" + (" is-invalid" if form.situacao_trabalho.errors else "")) }}
                                {% if form.situacao_trabalho.errors %}
                                    <div class="invalid-feedback">{{ form.situacao_trabalho.errors[0] }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Crianças 0-9 anos -->
                        <div class="row mb-3" id="crianca-container">
                            <div class="col-md-6">
                                {{ form.crianca_ficacom.label(class="form-label") }}
                                {{ form.crianca_ficacom(class="form-control") }}
                            </div>
                        </div>

                        <!-- Campos Sim/Não -->
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <div class="form-check">
                                    {{ form.frequenta_cuidador(class="form-check-input") }}
                                    {{ form.frequenta_cuidador.label(class="form-check-label") }}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-check">
                                    {{ form.participa_grupo(class="form-check-input") }}
                                    {{ form.participa_grupo.label(class="form-check-label") }}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-check">
                                    {{ form.possui_plano_saude(class="form-check-input") }}
                                    {{ form.possui_plano_saude.label(class="form-check-label") }}
                                </div>
                            </div>
                        </div>

                        <!-- Comunidade Tradicional -->
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <div class="form-check mb-2">
                                    {{ form.membro_comunidade(class="form-check-input") }}
                                    {{ form.membro_comunidade.label(class="form-check-label") }}
                                </div>
                                <div id="qual-comunidade-container" style="display: none;">
                                    {{ form.qual_comunidade.label(class="form-label") }}
                                    {{ form.qual_comunidade(class="form-control" + (" is-invalid" if form.qual_comunidade.errors else "")) }}
                                    {% if form.qual_comunidade.errors %}
                                        <div class="invalid-feedback">{{ form.qual_comunidade.errors[0] }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Orientação Sexual -->
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <div class="form-check mb-2">
                                    {{ form.informa_orientacao(class="form-check-input") }}
                                    {{ form.informa_orientacao.label(class="form-check-label") }}
                                </div>
                                <div id="orientacao-container" style="display: none;">
                                    {{ form.orientacao_sexual.label(class="form-label") }}
                                    {{ form.orientacao_sexual(class="form-control" + (" is-invalid" if form.orientacao_sexual.errors else "")) }}
                                    {% if form.orientacao_sexual.errors %}
                                        <div class="invalid-feedback">{{ form.orientacao_sexual.errors[0] }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Identidade de Gênero -->
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <div class="form-check mb-2">
                                    {{ form.informa_identidade(class="form-check-input") }}
                                    {{ form.informa_identidade.label(class="form-check-label") }}
                                </div>
                                <div id="identidade-container" style="display: none;">
                                    {{ form.identidade_genero.label(class="form-label") }}
                                    {{ form.identidade_genero(class="form-control" + (" is-invalid" if form.identidade_genero.errors else "")) }}
                                    {% if form.identidade_genero.errors %}
                                        <div class="invalid-feedback">{{ form.identidade_genero.errors[0] }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Deficiência -->
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <div class="form-check mb-2">
                                    {{ form.tem_deficiencia(class="form-check-input") }}
                                    {{ form.tem_deficiencia.label(class="form-check-label") }}
                                </div>
                                <div id="deficiencias-container" style="display: none;">
                                    {{ form.deficiencias.label(class="form-label") }}
                                    {{ form.deficiencias(class="form-select" + (" is-invalid" if form.deficiencias.errors else ""), multiple=True) }}
                                    {% if form.deficiencias.errors %}
                                        <div class="invalid-feedback">{{ form.deficiencias.errors[0] }}</div>
                                    {% endif %}
                                    <small class="form-text text-muted">Pressione Ctrl para selecionar múltiplas opções</small>
                                </div>
                            </div>
                        </div>

                        <!-- Saída do Cadastro -->
                        <div class="row mb-3">
                            <div class="col-md-4">
                                {{ form.motivo_saida.label(class="form-label") }}
                                {{ form.motivo_saida(class="form-control") }}
                            </div>
                            <div class="col-md-4" id="data-obito-container" style="display: none;">
                                {{ form.data_obito.label(class="form-label") }}
                                {{ form.data_obito(class="form-control" + (" is-invalid" if form.data_obito.errors else "")) }}
                                {% if form.data_obito.errors %}
                                    <div class="invalid-feedback">{{ form.data_obito.errors[0] }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-4" id="numero-do-container" style="display: none;">
                                {{ form.numero_do.label(class="form-label") }}
                                {{ form.numero_do(class="form-control" + (" is-invalid" if form.numero_do.errors else "")) }}
                                {% if form.numero_do.errors %}
                                    <div class="invalid-feedback">{{ form.numero_do.errors[0] }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- TRIA -->
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <h6 class="mb-3">Triagem para Risco de Insegurança Alimentar (TRIA)</h6>
                                <div class="form-check mb-2">
                                    {{ form.tria_alimentos_acabaram(class="form-check-input") }}
                                    {{ form.tria_alimentos_acabaram.label(class="form-check-label") }}
                                </div>
                                <div class="form-check">
                                    {{ form.tria_comeu_alguns(class="form-check-input") }}
                                    {{ form.tria_comeu_alguns.label(class="form-check-label") }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card-footer text-end">
                    <a href="{{ url_for('cadastro.lista_cadastros') }}" class="btn btn-secondary">Cancelar</a>
                    <button type="submit" class="btn btn-primary">Salvar Cadastro</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Manejo de etnia para indígenas
    const racaCorSelect = document.getElementById('raca_cor');
    const etniaContainer = document.getElementById('etnia-container');
    
    racaCorSelect.addEventListener('change', function() {
        etniaContainer.style.display = this.value === 'indigena' ? 'block' : 'none';
    });

    // Manejo de campos desconhecidos
    const maeDesconhecida = document.getElementById('mae_desconhecida');
    const nomeMae = document.getElementById('nome_mae');
    const paiDesconhecido = document.getElementById('pai_desconhecido');
    const nomePai = document.getElementById('nome_pai');

    maeDesconhecida.addEventListener('change', function() {
        nomeMae.disabled = this.checked;
        if (this.checked) {
            nomeMae.value = 'Desconhecido';
        } else {
            nomeMae.value = '';
        }
    });

    paiDesconhecido.addEventListener('change', function() {
        nomePai.disabled = this.checked;
        if (this.checked) {
            nomePai.value = 'Desconhecido';
        } else {
            nomePai.value = '';
        }
    });

    // Formateo de fechas
    function formatDate(input) {
        let value = input.value.replace(/\D/g, '');
        
        if (value.length > 0) {
            if (value.length > 2) {
                value = value.substring(0, 2) + '/' + value.substring(2);
            }
            if (value.length > 5) {
                value = value.substring(0, 5) + '/' + value.substring(5);
            }
            if (value.length > 10) {
                value = value.substring(0, 10);
            }
        }
        
        input.value = value;
    }

    const dateFields = ['data_nascimento', 'data_naturalizacao', 'data_entrada_brasil'];
    
    dateFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
            field.addEventListener('input', function(e) {
                formatDate(this);
            });
            
            field.addEventListener('paste', function(e) {
                e.preventDefault();
                let text = (e.originalEvent || e).clipboardData.getData('text/plain');
                text = text.replace(/\D/g, '');
                setTimeout(() => {
                    this.value = text;
                    formatDate(this);
                }, 0);
            });
        }
    });

    // Manejo de campos según nacionalidad
    const nacionalidadeSelect = document.getElementById('nacionalidade');
    const paisNascimentoGroup = document.getElementById('pais_nascimento').closest('.col-md-4');
    const dataNaturalizacaoGroup = document.getElementById('data_naturalizacao').closest('.col-md-4');
    const portariaNaturalizacaoGroup = document.getElementById('portaria_naturalizacao').closest('.col-md-4');
    const municipioNascimentoGroup = document.getElementById('municipio_nascimento').closest('.col-md-4');
    const ufNascimentoGroup = document.getElementById('uf_nascimento').closest('.col-md-4');
    const dataEntradaBrasilGroup = document.getElementById('data_entrada_brasil').closest('.col-md-4');

    function updateFieldsVisibility() {
        const nacionalidade = nacionalidadeSelect.value;

        // Campos para brasileiros
        municipioNascimentoGroup.style.display = nacionalidade === 'brasileira' ? 'block' : 'none';
        ufNascimentoGroup.style.display = nacionalidade === 'brasileira' ? 'block' : 'none';

        // Campos para naturalizados y extranjeros
        paisNascimentoGroup.style.display = nacionalidade === 'naturalizado' || nacionalidade === 'estrangeiro' ? 'block' : 'none';
        
        // Campos específicos para naturalizados
        dataNaturalizacaoGroup.style.display = nacionalidade === 'naturalizado' ? 'block' : 'none';
        portariaNaturalizacaoGroup.style.display = nacionalidade === 'naturalizado' ? 'block' : 'none';

        // Campos específicos para extranjeros
        dataEntradaBrasilGroup.style.display = nacionalidade === 'estrangeiro' ? 'block' : 'none';

        // Limpiar campos ocultos
        if (nacionalidade === 'brasileira') {
            document.getElementById('pais_nascimento').value = '';
            document.getElementById('data_naturalizacao').value = '';
            document.getElementById('portaria_naturalizacao').value = '';
            document.getElementById('data_entrada_brasil').value = '';
        } else if (nacionalidade === 'naturalizado') {
            document.getElementById('data_entrada_brasil').value = '';
        } else if (nacionalidade === 'estrangeiro') {
            document.getElementById('data_naturalizacao').value = '';
            document.getElementById('portaria_naturalizacao').value = '';
        }
    }

    nacionalidadeSelect.addEventListener('change', updateFieldsVisibility);
    
    // Ejecutar al cargar la página para establecer el estado inicial
    updateFieldsVisibility();

    // Agregar al script existente
    function validateForm() {
        const maeDesconhecida = document.getElementById('mae_desconhecida');
        const nomeMae = document.getElementById('nome_mae');
        const paiDesconhecido = document.getElementById('pai_desconhecido');
        const nomePai = document.getElementById('nome_pai');
        let isValid = true;

        // Validar nome da mãe
        if (!maeDesconhecida.checked && !nomeMae.value.trim()) {
            nomeMae.classList.add('is-invalid');
            if (!nomeMae.nextElementSibling) {
                const feedback = document.createElement('div');
                feedback.className = 'invalid-feedback';
                feedback.textContent = 'Nome da mãe é obrigatório quando não for desconhecido';
                nomeMae.parentNode.appendChild(feedback);
            }
            isValid = false;
        }

        // Validar nome do pai
        if (!paiDesconhecido.checked && !nomePai.value.trim()) {
            nomePai.classList.add('is-invalid');
            if (!nomePai.nextElementSibling) {
                const feedback = document.createElement('div');
                feedback.className = 'invalid-feedback';
                feedback.textContent = 'Nome do pai é obrigatório quando não for desconhecido';
                nomePai.parentNode.appendChild(feedback);
            }
            isValid = false;
        }

        return isValid;
    }

    // Modificar el formulario para usar la validación
    const form = document.querySelector('form');
    form.addEventListener('submit', function(e) {
        if (!validateForm()) {
            e.preventDefault();
        }
    });

    // Limpiar validación cuando se marca como desconocido (padre)
    paiDesconhecido.addEventListener('change', function() {
        if (this.checked) {
            nomePai.classList.remove('is-invalid');
            const feedback = nomePai.nextElementSibling;
            if (feedback && feedback.className === 'invalid-feedback') {
                feedback.remove();
            }
        }
    });

    // Agregar al script existente
    const responsavelFamiliar = document.getElementById('responsavel_familiar');
    const dadosResponsavel = document.getElementById('dados_responsavel');

    responsavelFamiliar.addEventListener('change', function() {
        dadosResponsavel.style.display = this.checked ? 'none' : 'flex';
        if (this.checked) {
            document.getElementById('cns_responsavel').value = '';
            document.getElementById('cpf_responsavel').value = '';
        }
    });

    // Ejecutar al cargar la página
    dadosResponsavel.style.display = responsavelFamiliar.checked ? 'none' : 'flex';

    // Calcular edad y mostrar/ocultar campos de criança
    const dataNascimento = document.getElementById('data_nascimento');
    const criancaContainer = document.getElementById('crianca-container');
    
    function calcularIdade(dataNasc) {
        const hoje = new Date();
        const nascimento = new Date(dataNasc.split('/').reverse().join('-'));
        let idade = hoje.getFullYear() - nascimento.getFullYear();
        const m = hoje.getMonth() - nascimento.getMonth();
        if (m < 0 || (m === 0 && hoje.getDate() < nascimento.getDate())) {
            idade--;
        }
        return idade;
    }

    function verificarIdade() {
        if (dataNascimento.value) {
            const idade = calcularIdade(dataNascimento.value);
            criancaContainer.style.display = idade <= 9 ? 'block' : 'none';
        }
    }

    dataNascimento.addEventListener('change', verificarIdade);
    verificarIdade();

    // Comunidade Tradicional
    const membroComunidade = document.getElementById('membro_comunidade');
    const qualComunidadeContainer = document.getElementById('qual-comunidade-container');

    membroComunidade.addEventListener('change', function() {
        qualComunidadeContainer.style.display = this.checked ? 'block' : 'none';
    });

    // Orientação Sexual
    const informaOrientacao = document.getElementById('informa_orientacao');
    const orientacaoContainer = document.getElementById('orientacao-container');

    informaOrientacao.addEventListener('change', function() {
        orientacaoContainer.style.display = this.checked ? 'block' : 'none';
    });

    // Identidade de Gênero
    const informaIdentidade = document.getElementById('informa_identidade');
    const identidadeContainer = document.getElementById('identidade-container');

    informaIdentidade.addEventListener('change', function() {
        identidadeContainer.style.display = this.checked ? 'block' : 'none';
    });

    // Deficiência
    const temDeficiencia = document.getElementById('tem_deficiencia');
    const deficienciasContainer = document.getElementById('deficiencias-container');

    temDeficiencia.addEventListener('change', function() {
        deficienciasContainer.style.display = this.checked ? 'block' : 'none';
    });

    // Saída do Cadastro
    const motivoSaida = document.getElementById('motivo_saida');
    const dataObitoContainer = document.getElementById('data-obito-container');
    const numeroDOContainer = document.getElementById('numero-do-container');

    motivoSaida.addEventListener('change', function() {
        const isObito = this.value === 'obito';
        dataObitoContainer.style.display = isObito ? 'block' : 'none';
        numeroDOContainer.style.display = isObito ? 'block' : 'none';
    });
});
</script>
{% endblock %} 