{% extends "base.html" %}
{% from 'bootstrap/form.html' import render_form, render_field %}

{% block title %}Novo Cadastro Individual{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Cadastro Individual</h2>
    <form method="POST" class="form" role="form">
        {{ form.csrf_token }}
        
        <!-- Identificação do Cidadão -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">Identificação do Cidadão</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">{{ render_field(form.nome_completo) }}</div>
                    <div class="col-md-6">{{ render_field(form.nome_social) }}</div>
                </div>
                <div class="row">
                    <div class="col-md-4">{{ render_field(form.data_nascimento) }}</div>
                    <div class="col-md-4">{{ render_field(form.sexo) }}</div>
                    <div class="col-md-4">{{ render_field(form.raca_cor) }}</div>
                </div>
                <div class="row">
                    <div class="col-md-6">{{ render_field(form.nacionalidade) }}</div>
                    <div class="col-md-6">{{ render_field(form.etnia) }}</div>
                </div>
            </div>
        </div>

        <!-- Documentos -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">Documentos</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">{{ render_field(form.cns) }}</div>
                    <div class="col-md-4">{{ render_field(form.cpf) }}</div>
                    <div class="col-md-4">{{ render_field(form.numero_nis) }}</div>
                </div>
            </div>
        </div>

        <!-- Filiação -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">Filiação</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-5">{{ render_field(form.nome_mae) }}</div>
                    <div class="col-md-1">{{ render_field(form.desconhece_nome_mae) }}</div>
                    <div class="col-md-5">{{ render_field(form.nome_pai) }}</div>
                    <div class="col-md-1">{{ render_field(form.desconhece_nome_pai) }}</div>
                </div>
            </div>
        </div>

        <!-- Naturalização -->
        <div class="card mb-4" id="naturalizacao-card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">Naturalização</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">{{ render_field(form.data_naturalizacao) }}</div>
                    <div class="col-md-4">{{ render_field(form.portaria_naturalizacao) }}</div>
                    <div class="col-md-4">{{ render_field(form.data_entrada_brasil) }}</div>
                </div>
                <div class="row">
                    <div class="col-md-6">{{ render_field(form.pais_nascimento) }}</div>
                </div>
            </div>
        </div>

        <!-- Contato e Localização -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">Contato e Localização</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">{{ render_field(form.email) }}</div>
                    <div class="col-md-6">{{ render_field(form.telefone) }}</div>
                </div>
                <div class="row">
                    <div class="col-md-4">{{ render_field(form.municipio_nascimento) }}</div>
                    <div class="col-md-4">{{ render_field(form.microarea) }}</div>
                    <div class="col-md-4">{{ render_field(form.st_fora_area) }}</div>
                </div>
            </div>
        </div>

        <!-- Informações Sociodemográficas -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">Informações Sociodemográficas</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">{{ render_field(form.frequenta_escola) }}</div>
                    <div class="col-md-3">{{ render_field(form.curso_mais_elevado) }}</div>
                    <div class="col-md-3">{{ render_field(form.situacao_trabalho) }}</div>
                    <div class="col-md-3">{{ render_field(form.ocupacao_codigo_cbo2002) }}</div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        {{ render_field(form.status_deseja_informar_orientacao_sexual) }}
                        <div id="orientacao-sexual-container">
                            {{ render_field(form.orientacao_sexual) }}
                        </div>
                    </div>
                    <div class="col-md-6">
                        {{ render_field(form.status_deseja_informar_identidade_genero) }}
                        <div id="identidade-genero-container">
                            {{ render_field(form.identidade_genero) }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Condições de Saúde -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">Condições de Saúde</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">{{ render_field(form.status_eh_gestante) }}</div>
                    <div class="col-md-9" id="maternidade-container">
                        {{ render_field(form.maternidade_referencia) }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">{{ render_field(form.status_tem_hipertensao) }}</div>
                    <div class="col-md-4">{{ render_field(form.status_tem_diabetes) }}</div>
                    <div class="col-md-4">{{ render_field(form.status_tem_deficiencia) }}</div>
                </div>
                <div class="row" id="deficiencias-container">
                    <div class="col-md-12">{{ render_field(form.deficiencias) }}</div>
                </div>
            </div>
        </div>

        <!-- Situação de Rua -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">Situação de Rua</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">{{ render_field(form.status_situacao_rua) }}</div>
                    <div class="col-md-8" id="tempo-rua-container">
                        {{ render_field(form.tempo_rua) }}
                    </div>
                </div>
            </div>
        </div>

        <!-- Botões -->
        <div class="form-group text-center mb-4">
            {{ form.submit(class="btn btn-primary btn-lg") }}
            <a href="{{ url_for('main.index') }}" class="btn btn-secondary btn-lg">Cancelar</a>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
$(document).ready(function() {
    // Función para manejar campos condicionales
    function toggleField(triggerField, targetContainer, condition) {
        $(triggerField).change(function() {
            if (condition($(this))) {
                $(targetContainer).slideDown();
            } else {
                $(targetContainer).slideUp();
            }
        }).trigger('change');
    }

    // Gestante y Maternidad
    toggleField('#status_eh_gestante', '#maternidade-container', 
        $el => $el.is(':checked'));

    // Orientación Sexual
    toggleField('#status_deseja_informar_orientacao_sexual', '#orientacao-sexual-container', 
        $el => $el.is(':checked'));

    // Identidad de Género
    toggleField('#status_deseja_informar_identidade_genero', '#identidade-genero-container', 
        $el => $el.is(':checked'));

    // Deficiencia
    toggleField('#status_tem_deficiencia', '#deficiencias-container', 
        $el => $el.is(':checked'));

    // Situación de Calle
    toggleField('#status_situacao_rua', '#tempo-rua-container', 
        $el => $el.is(':checked'));

    // Naturalización
    $('#nacionalidade').change(function() {
        if ($(this).val() == '2') { // Naturalizado
            $('#naturalizacao-card').slideDown();
        } else {
            $('#naturalizacao-card').slideUp();
        }
    }).trigger('change');

    // Inicializar datepickers
    $('.datepicker').datepicker({
        format: 'dd/mm/yyyy',
        language: 'pt-BR',
        autoclose: true
    });
});
</script>
{% endblock %} 